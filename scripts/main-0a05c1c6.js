"use strict";angular.module("spotifyViz",["ngAnimate","ngCookies","ngTouch","ngSanitize","ui.router","ngMaterial","controllers.logout","controllers.home","controllers.splash","controllers.compute","controllers.vizualize","spotify","qAllSettled"]).config(["$stateProvider","$urlRouterProvider","$mdThemingProvider","SpotifyProvider",function(e,t,l,a){a.setClientId("835d8a553e434b99b9f2314d3fe6d90d"),a.setRedirectUri("https://reimertz.github.io/spotify-viz/callback.html"),a.setScope("playlist-read-private user-follow-read user-library-read"),l.theme("default").primaryPalette("red").accentPalette("yellow"),e.state("splash",{url:"/",templateUrl:"partials/splash.html",controller:"SplashCtrl",authenticate:!1}).state("main",{url:"/main",templateUrl:"partials/main.html",controller:"MainCtrl",authenticate:!0}).state("computeHack",{url:"/compute",templateUrl:"partials/compute.html",controller:"ComputeCtrl",authenticate:!0}).state("compute",{url:"/compute",templateUrl:"partials/compute.html",controller:"ComputeCtrl",params:{user:void 0,challenger:void 0},authenticate:!0}).state("vizualizeHack",{url:"/vizualize",templateUrl:"partials/vizualize.html",controller:"VizualizeCtrl",authenticate:!0}).state("vizualize",{url:"/vizualize",templateUrl:"partials/vizualize.html",controller:"VizualizeCtrl",params:{user:void 0,challenger:void 0},authenticate:!0}).state("logout",{url:"/logout",templateUrl:"partials/splash.html",controller:"LogoutCtrl",authenticate:!0}),t.otherwise("/")}]).run(["$state","$rootScope",function(e,t){t.$on("$stateChangeStart",function(t,l){!l.authenticate&&localStorage.userId?(t.preventDefault(),e.go("main")):l.authenticate&&!localStorage.userId&&(t.preventDefault(),e.go("splash"))}),function(){if(!document.getElementById("facebook-jssdk")){var e=document.getElementsByTagName("script")[0],t=document.createElement("script");t.id="facebook-jssdk",t.src="//connect.facebook.net/en_US/all.js",e.parentNode.insertBefore(t,e)}}()}]),angular.module("qAllSettled",[]).config(["$provide",function(e){e.decorator("$q",["$delegate",function(e){var t=e;return t.allSettled=function(e){return t.all(e.map(function(e){return e.then(function(e){return{state:"fulfilled",value:e}},function(e){return{state:"rejected",reason:e}})}))},t}])}]),angular.module("controllers.home",[]).controller("MainCtrl",["$scope","$state","$q","$timeout","Spotify","$mdToast",function(e,t,l,a,r){function o(){r.setAuthToken(localStorage["spotify-token"]),r.getCurrentUser().then(function(t){console.log(t),e.user=t},function(){t.go("logout")})}e.invalidUser=!1,e.user={},e.challenger={},o(),e.checkUserId=function(l){r.getUser(l).then(function(a){e.challenger=a,r.userFollowingContains("user",l).then(function(l){e.challenger.IsFollowingUser=l,t.go("compute",{user:e.user,challenger:e.challenger})})},function(){e.invalidUser=!0})},e.logout=function(){t.go("logout")}}]),angular.module("controllers.logout",[]).controller("LogoutCtrl",["$state",function(e){localStorage.removeItem("userId"),localStorage.removeItem("spotify-token"),e.go("splash")}]),angular.module("controllers.splash",[]).controller("SplashCtrl",["$scope","Spotify","$state",function(e,t,l){e.login=function(){t.login().then(function(){t.getCurrentUser().then(function(e){localStorage.userId=e.id,l.go("main")})})}}]),angular.module("controllers.compute",[]).controller("ComputeCtrl",["$scope","$state","$stateParams","$q","$timeout","Spotify","$mdToast",function(e,t,l,a,r,o){function s(e){var t=a.defer(),l=0;return e.forEach(function(a,r){a.tracks.items.map(function(e){l+=e.track.popularity}),e.length-1==r&&t.resolve(l)}),t.promise}function n(e){var t=[];return t.push(u(0).then(function(){return o.getUserPlaylists(e,{offset:0})})),t.push(u(400).then(function(){return o.getUserPlaylists(e,{offset:25})})),t.push(u(800).then(function(){return o.getUserPlaylists(e,{offset:50})})),t.push(u(1200).then(function(){return o.getUserPlaylists(e,{offset:75})})),t.push(u(1600).then(function(){return o.getUserPlaylists(e,{offset:100})})),t.push(u(1800).then(function(){return o.getUserPlaylists(e,{offset:100})})),t.push(u(2200).then(function(){return o.getUserPlaylists(e,{offset:125})})),t.push(u(2600).then(function(){return o.getUserPlaylists(e,{offset:150})})),t.push(u(3200).then(function(){return o.getUserPlaylists(e,{offset:175})})),t.push(u(3600).then(function(){return o.getUserPlaylists(e,{offset:200})})),a.allSettled(t).then(function(e){var t=[];return e.forEach(function(e){"fulfilled"===e.state&&(t=t.concat(e.value.items))}),t})}function i(e,t){var l=[],r=0,s=0,n=0,i=0,c=0;return t.forEach(function(t,a){r+=t.tracks.total,t.owner.id==e?(s+=t.collaborative?1:0,n+=t["public"]?1:0,l.push(u(100*a).then(function(){return o.getPlaylist(e,t.id)}))):c+=1}),a.allSettled(l).then(function(e){var t=[];return e.forEach(function(e){"fulfilled"===e.state&&(t.push(e.value),i+=e.value.followers.total)}),{playlists:t,totalSongs:r,totalCollaboratives:s,totalPublics:n,totalPlaylistFollowers:i,totalOtherPlaylists:c}})}function u(e){var t=a.defer();return r(t.resolve,e),t.promise}return l.user&&l.challenger?(e.user=l.user,e.challenger=l.challenger,e.user.playlists=[],e.challenger.playlists=[],e.status="Fetching User data..",a.all([n(e.user.id),n(e.challenger.id)]).then(function(t){e.status="Fetching Playlists..",e.user.playlists=t[0],e.challenger.playlists=t[1]}).then(function(){var l=[];e.status="Analyzing Playlist data...",l.push(i(e.user.id,e.user.playlists)),l.push(i(e.challenger.id,e.challenger.playlists)),a.all(l).then(function(l){var r=[];e.status="Analyzing popularity data..",angular.extend(e.user,e.user,l[0]),angular.extend(e.challenger,e.challenger,l[1]),r.push(s(e.user.playlists)),r.push(s(e.challenger.playlists)),a.all(r).then(function(l){e.status="Finalizing data...",e.user.popularity=(l[0]/e.user.totalSongs).toFixed(2),e.challenger.popularity=(l[1]/e.challenger.totalSongs).toFixed(2),delete e.user.playlists,delete e.challenger.playlists,t.go("vizualize",{user:e.user,challenger:e.challenger})})})}),void(e.cancel=function(){t.go("main")})):t.go("main")}]),angular.module("controllers.vizualize",[]).controller("VizualizeCtrl",["$scope","$state","$stateParams","$q","$timeout","Spotify","$mdToast",function(e,t,l){function a(){e.user.popularity=parseInt(e.user.popularity),e.challenger.popularity=parseInt(e.challenger.popularity),e.hipsterClass=e.user.popularity<e.challenger.popularity?"user":"challenger",e.wonHipster=e[e.hipsterClass],e.wonHipsterName=e.wonHipster.display_name||e.wonHipster.id,e.lostHipster=e.wonHipster===e.user?e.challenger:e.user,e.lostHipsterName=e.lostHipster.display_name||e.lostHipster.id,e.userHipsterPercentage=e.user.popularity/(e.user.popularity+e.challenger.popularity)*100,e.challengerHipsterPercentage=e.challenger.popularity/(e.user.popularity+e.challenger.popularity)*100,e.userHipsterPercentage=100-i(e.userHipsterPercentage),e.challengerHipsterPercentage=100-i(e.challengerHipsterPercentage)}function r(){e.superstarClass=e.user.followers.total>e.challenger.followers.total?"user":"challenger",e.wonSuperstar=e[e.superstarClass],e.wonSuperstarName=e.wonSuperstar.display_name||e.wonSuperstar.id,e.lostSuperstar=e.wonSuperstar===e.user?e.challenger:e.user,e.lostSuperstarName=e.lostSuperstar.display_name||e.lostSuperstar.id,e.userSuperstarPercentage=e.user.followers.total/(e.user.followers.total+e.challenger.followers.total)*100,e.challengerSuperstarPercentage=e.challenger.followers.total/(e.user.followers.total+e.challenger.followers.total)*100,e.userSuperstarPercentage=i(e.userSuperstarPercentage),e.challengerSuperstarPercentage=i(e.challengerSuperstarPercentage)}function o(){e.giverClass=e.user.totalPublics>e.challenger.totalPublics?"user":"challenger",e.wonGiver=e[e.giverClass],e.wonGiverName=e.wonGiver.display_name||e.wonGiver.id,e.lostGiver=e.wonGiver===e.user?e.challenger:e.user,e.lostGiverName=e.lostGiver.display_name||e.lostGiver.id,e.userGiverPercentage=e.user.totalPublics/(e.user.totalPublics+e.challenger.totalPublics)*100,e.challengerGiverPercentage=e.challenger.totalPublics/(e.user.totalPublics+e.challenger.totalPublics)*100,e.userGiverPercentage=i(e.userGiverPercentage),e.challengerGiverPercentage=i(e.challengerGiverPercentage)}function s(){e.collaboratorClass=e.user.totalCollaboratives>e.challenger.totalCollaboratives?"user":"challenger",e.wonCollaborator=e[e.collaboratorClass],e.wonCollaboratorName=e.wonCollaborator.display_name||e.wonCollaborator.id,e.lostCollaborator=e.wonCollaborator===e.user?e.challenger:e.user,e.lostCollaboratorName=e.lostCollaborator.display_name||e.lostCollaborator.id,e.userCollaboratorPercentage=e.user.totalCollaboratives/(e.user.totalCollaboratives+e.challenger.totalCollaboratives)*100,e.challengerCollaboratorPercentage=e.challenger.totalCollaboratives/(e.user.totalCollaboratives+e.challenger.totalCollaboratives)*100,e.userCollaboratorPercentage=i(e.userCollaboratorPercentage),e.challengerCollaboratorPercentage=i(e.challengerCollaboratorPercentage)}function n(){e.hoarderClass=e.user.totalSongs>e.challenger.totalSongs?"user":"challenger",e.wonHoarder=e[e.hoarderClass],e.wonHoarderName=e.wonHoarder.display_name||e.wonHoarder.id,e.lostHoarder=e.wonHoarder===e.user?e.challenger:e.user,e.lostHoarderName=e.lostHoarder.display_name||e.lostHoarder.id,e.userHoarderPercentage=e.user.totalSongs/(e.user.totalSongs+e.challenger.totalSongs)*100,e.challengerHoarderPercentage=e.challenger.totalSongs/(e.user.totalSongs+e.challenger.totalSongs)*100,e.userHoarderPercentage=i(e.userHoarderPercentage),e.challengerHoarderPercentage=i(e.challengerHoarderPercentage)}function i(e){return e%5>2.5?e-e%5+5:e-e%5}return l.user&&l.challenger?(e.user=l.user,e.challenger=l.challenger,a(),r(),o(),s(),n(),void(e.again=function(){t.go("main")})):t.go("main")}]),function(e){try{e=angular.module("spotifyViz")}catch(t){e=angular.module("spotifyViz",[])}e.run(["$templateCache",function(e){e.put("partials/compute.html",'<div layout="column" class="compute-view"><div layout="column" class="swosh" layout-align="center center" flex="80"><h1>Calculating all the magic..</h1><md-progress-circular class="md-hue-8" md-mode="indeterminate"></md-progress-circular><h3>{{status}}</h3></div><div layout="column" layout-align="end center" flex="10"><md-button class="md-raised md-primary" ng-click="cancel()">Cancel</md-button></div></div>')}])}(),function(e){try{e=angular.module("spotifyViz")}catch(t){e=angular.module("spotifyViz",[])}e.run(["$templateCache",function(e){e.put("partials/logout.html",'<div layout="column" class="splash-view"><md-toolbar layout="row"><h1>Spotify Working Title App</h1></md-toolbar></div>')}])}(),function(e){try{e=angular.module("spotifyViz")}catch(t){e=angular.module("spotifyViz",[])}e.run(["$templateCache",function(e){e.put("partials/main-old.html",'<div layout="column" class="menu-view"><md-toolbar layout="row"><button ng-click="toggleSidenav(\'left\')" hide-gt-sm="" class="menuBtn"><span class="visuallyhidden">Menu</span></button><h1>AngularJS Material App</h1></md-toolbar><div layout="row" flex=""><md-sidenav class="md-sidenav-left md-whiteframe-z2" md-component-id="left" md-is-locked-open="$media(\'gt-sm\')"><md-list><md-item ng-repeat="it in avatars"><md-item-content><md-button ng-click="selectAvatar(it)" ng-class="{\'selected\' : it === selected }"><span class="{{it.classname}} avatar"></span> {{it.name}}</md-button></md-item-content></md-item></md-list></md-sidenav><md-content layout="column" flex="" class="content-wrapper md-padding" id="content"><span class="{{selected.classname}}" ng-class="{avatar:selected}" role="img" aria-label="{{selected.name}}"></span><h2>{{selected.name}}</h2><p>{{selected.content}}</p><md-button class="action actionBtn" ng-click="showActions($event)"><span class="visuallyhidden">Actions</span></md-button></md-content></div></div>')}])}(),function(e){try{e=angular.module("spotifyViz")}catch(t){e=angular.module("spotifyViz",[])}e.run(["$templateCache",function(e){e.put("partials/main.html",'<div layout="column" class="main-view"><md-toolbar layout="row"><h1>Hi {{user.display_name}}</h1></md-toolbar><div layout="column" class="swosh" layout-align="center center" flex="40"><h2>Enter the Spotify Id of your person you want to challenge</h2><form name="userIdForm"><div layout"column"=""><md-input-container class="md-accent" md-is-error="invalidUser" ng-click="userId=\'\'; invalidUser=false;"><label>User Id</label> <input ng-model="userId"><div ng-messages="userForm.bio.$error" ng-show="invalidUser"><div ng-message="invalidUser">User Id is non existing</div></div></md-input-container></div></form><md-button class="md-raised md-primary" ng-click="checkUserId(userId)">Let\'s do it!</md-button></div><div layout="column" layout-align="end center" flex="50"><md-button class="md-raised md-primary" ng-click="logout()">logout</md-button></div></div>')}])}(),function(e){try{e=angular.module("spotifyViz")}catch(t){e=angular.module("spotifyViz",[])}e.run(["$templateCache",function(e){e.put("partials/splash.html",'<div layout="column" class="splash-view"><md-toolbar layout="row"><h1>Spotify Working Title App</h1></md-toolbar><div layout="column" class="swosh" layout-align="center center" flex="50"><h2>Sign in with Spotify to compare your</h2><md-button class="md-raised md-primary" ng-click="login()">Login to Spotify</md-button></div></div>')}])}(),function(e){try{e=angular.module("spotifyViz")}catch(t){e=angular.module("spotifyViz",[])}e.run(["$templateCache",function(e){e.put("partials/vizualize.html",'<div layout="column" class="vizualize-view"><div id="ready" layout="column" class="swosh" layout-align="center center" flex="80"><h1>Are you Ready?</h1><h2>{{user.display_name || user.id}} vs. {{challenger.display_name || challenger.id}}</h2></div><div id="hipster" layout="row" class="{{hipsterClass}}-won" flex="20"><div layout="row" flex="50" class="user"><div flex="{{challengerHipsterPercentage}}" class="rest"><md-tooltip md-visible="showTooltips">asd</md-tooltip></div><div flex="{{userHipsterPercentage}}" class="won"><md-tooltip md-visible="showTooltips">asd</md-tooltip></div></div><div layout="row" flex="50" class="challenger"><div flex="{{challengerHipsterPercentage}}" class="won"></div><div flex="{{userHipsterPercentage}}" class="rest"></div></div></div><div id="hipster" layout="column" class="swosh" layout-align="start center" flex="20"></div><div id="hipster" layout="column" class="swosh" layout-align="start center" flex="60"><h1>{{wonHipsterName}} is the The Hipster</h1><h2>"a person who follows the latest trends and fashions, especially those regarded as being outside the cultural mainstream."</h2><h3>{{wonHipsterName}} had the average of {{wonHipster.popularity}} and beat {{lostHipsterName}} who had an average of {{lostHipster.popularity}}.</h3></div><div id="superstar" layout="row" class="swosh {{superstarClass}}-won" flex="20"><div layout="row" flex="50" class="user"><div flex="{{challengerSuperstarPercentage}}" class="rest"></div><div flex="{{userSuperstarPercentage}}" class="won"></div></div><div layout="row" flex="50" class="challenger"><div flex="{{challengerSuperstarPercentage}}" class="won"></div><div flex="{{userSuperstarPercentage}}" class="rest"></div></div></div><div id="superstar" layout="column" class="swosh" layout-align="start center" flex="20"></div><div id="superstar" layout="column" class="swosh" layout-align="start center" flex="60"><h1>{{wonSuperstarName}} is the The Superstar</h1><h2></h2><h3>{{wonSuperstarName}} had {{wonSuperstar.followers.total - lostSuperstar.followers.total}} more followers than {{lostSuperstarName}} and</h3></div><div id="giver" layout="row" class="swosh {{giverClass}}-won" flex="20"><div layout="row" flex="50" class="user"><div flex="{{challengerGiverPercentage}}" class="rest"></div><div flex="{{userGiverPercentage}}" class="won"></div></div><div layout="row" flex="50" class="challenger"><div flex="{{challengerGiverPercentage}}" class="won"></div><div flex="{{userGiverPercentage}}" class="rest"></div></div></div><div id="giver" layout="column" class="swosh" layout-align="start center" flex="20"></div><div id="giver" layout="column" class="swosh" layout-align="start center" flex="60"><h1>{{wonGiverName}} is the The Giver</h1><h2></h2><h3>{{wonGiverName}} have {{wonGiver.totalPublics - lostGiver.totalPublics}} more public playlists than {{lostGiverName}} and could be considered a genorous person!</h3></div><div id="collaborator" layout="row" class="swosh {{collaboratorClass}}-won" flex="20"><div layout="row" flex="50" class="user"><div flex="{{challengerCollaboratorPercentage}}" class="rest"></div><div flex="{{userCollaboratorPercentage}}" class="won"></div></div><div layout="row" flex="50" class="challenger"><div flex="{{challengerCollaboratorPercentage}}" class="won"></div><div flex="{{userCollaboratorPercentage}}" class="rest"></div></div></div><div id="collaborator" layout="column" class="swosh" layout-align="start center" flex="20"></div><div id="collaborator" layout="column" class="swosh" layout-align="start center" flex="60"><h1>{{wonCollaboratorName}} is the The Collaborator</h1><h2></h2><h3>{{wonCollaboratorName}} have {{wonCollaborator.totalSongs - lostCollaborator.totalSongs}} more Collaborative playlists {{lostCollaboratorName}} and could be considered a co-working person!</h3></div><div id="hoarder" layout="row" class="swosh {{hoarderClass}}-won" flex="20"><div layout="row" flex="50" class="user"><div flex="{{challengerHoarderPercentage}}" class="rest"></div><div flex="{{userHoarderPercentage}}" class="won"></div></div><div layout="row" flex="50" class="challenger"><div flex="{{challengerHoarderPercentage}}" class="won"></div><div flex="{{userHoarderPercentage}}" class="rest"></div></div></div><div id="hoarder" layout="column" class="swosh" layout-align="start center" flex="20"></div><div id="hoarder" layout="column" class="swosh" layout-align="start center" flex="60"><h1>{{wonHoarderName}} is the The Hoarder</h1><h2></h2><h3>{{wonHoarderName}} have collected {{wonHoarder.totalSongs}} songs over the years..</h3></div><div id="share" layout="column" class="swosh" layout-align="center center" flex="40"><h1>Want to do it again?</h1><md-button class="md-raised md-primary" ng-click="again()">Do it again with another user</md-button></div></div>')}])}();